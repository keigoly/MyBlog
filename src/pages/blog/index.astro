---
// src/pages/blog/index.astro - Blog List Page
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import SectionTitle from "../../components/ui/SectionTitle";

const allPosts = await getCollection("blog");
const sortedPosts = allPosts.sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<BaseLayout title="BLOG" description="ブログ記事一覧">
    <section class="pt-32 pb-16 md:pt-40 md:pb-24">
        <SectionTitle
            client:visible
            title="BLOG"
            subtitle="Articles & Thoughts"
        />
    </section>

    <section class="pb-24 md:pb-32">
        {
            sortedPosts.length > 0 ? (
                <div class="space-y-8 max-w-3xl mx-auto">
                    {sortedPosts.map((post) => (
                        <article class="group relative p-6 md:p-8 bg-kg-surface border border-kg-border rounded-sm hover:border-kg-accent/50 transition-all duration-300">
                            <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
                                <div class="flex-grow">
                                    <div class="flex items-center gap-4 mb-3">
                                        <time
                                            datetime={post.data.pubDate.toISOString()}
                                            class="text-xs font-display tracking-widest text-kg-text-muted"
                                        >
                                            {post.data.pubDate.toLocaleDateString(
                                                "en-US",
                                                {
                                                    year: "numeric",
                                                    month: "short",
                                                    day: "numeric",
                                                },
                                            )}
                                        </time>
                                        {post.data.tags.length > 0 && (
                                            <span class="text-xs text-kg-accent font-display tracking-widest">
                                                {post.data.tags[0]}
                                            </span>
                                        )}
                                    </div>

                                    <a
                                        href={`/blog/${post.slug}`}
                                        class="block"
                                    >
                                        <h2 class="text-xl md:text-2xl font-serif text-kg-text group-hover:text-kg-accent transition-colors duration-300 mb-2">
                                            {post.data.title}
                                        </h2>
                                    </a>

                                    <p class="text-sm text-kg-text-muted line-clamp-2">
                                        {post.data.description}
                                    </p>
                                </div>

                                <a
                                    href={`/blog/${post.slug}`}
                                    class="flex-shrink-0 flex items-center gap-2 text-kg-text-muted group-hover:text-kg-accent transition-colors duration-300"
                                >
                                    <span class="text-xs font-display tracking-widest">
                                        READ
                                    </span>
                                    <span>→</span>
                                </a>
                            </div>
                        </article>
                    ))}
                </div>
            ) : (
                <div class="text-center py-16">
                    <p class="font-serif text-kg-text-muted">
                        No articles yet...
                    </p>
                </div>
            )
        }
    </section>
</BaseLayout>
